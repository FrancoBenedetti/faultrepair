<VirtualHost *:443>
    ServerName fault-reporter.local
    ServerAlias www.fault-reporter.local

    # SSL Configuration
    SSLEngine on
    SSLCertificateFile /etc/ssl/certs/fault-reporter.local.crt
    SSLCertificateKeyFile /etc/ssl/private/fault-reporter.local.key

    # Document root should point to the public directory
    DocumentRoot /home/franco/Projects/fault-reporter/public

    # Enable .htaccess overrides
    <Directory "/home/franco/Projects/fault-reporter/public">
        AllowOverride All
        Require all granted

        # CORS headers for frontend API calls
        Header set Access-Control-Allow-Origin "*"
        Header set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
        Header set Access-Control-Allow-Headers "Content-Type, Authorization, X-Requested-With"
    </Directory>

    # Alias for backend API directory
    Alias /backend /home/franco/Projects/fault-reporter/backend
    <Directory "/home/franco/Projects/fault-reporter/backend">
        AllowOverride All
        Require all granted

        # CORS headers for API endpoints
        Header set Access-Control-Allow-Origin "*"
        Header set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
        Header set Access-Control-Allow-Headers "Content-Type, Authorization"

        # PHP configuration
        php_value include_path ".:/home/franco/Projects/fault-reporter/backend"
    </Directory>

    # Enable PHP processing for .php files
    <FilesMatch \.php$>
        SetHandler application/x-httpd-php
    </FilesMatch>

    # Error and access logs
    ErrorLog ${APACHE_LOG_DIR}/fault-reporter-ssl_error.log
    CustomLog ${APACHE_LOG_DIR}/fault-reporter-ssl_access.log combined
</VirtualHost>

# Redirect HTTP to HTTPS
<VirtualHost *:80>
    ServerName fault-reporter.local
    ServerAlias www.fault-reporter.local
    Redirect permanent / https://fault-reporter.local/
</VirtualHost>
